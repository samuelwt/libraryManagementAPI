<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Library API Client - Frontend Demo</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    h1 {
      color: white;
      text-align: center;
      margin-bottom: 10px;
      font-size: 2.5em;
    }

    .subtitle {
      color: rgba(255, 255, 255, 0.9);
      text-align: center;
      margin-bottom: 30px;
      font-size: 1.1em;
    }

    .card {
      background: white;
      border-radius: 12px;
      padding: 25px;
      margin-bottom: 20px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    }

    .card h2 {
      color: #667eea;
      margin-bottom: 20px;
      border-bottom: 2px solid #f0f0f0;
      padding-bottom: 10px;
    }

    .filters {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }

    .input-group {
      display: flex;
      flex-direction: column;
    }

    .input-group label {
      font-size: 0.9em;
      color: #666;
      margin-bottom: 5px;
      font-weight: 600;
    }

    .input-group input,
    .input-group select {
      padding: 10px;
      border: 2px solid #e0e0e0;
      border-radius: 6px;
      font-size: 1em;
      transition: border-color 0.3s;
    }

    .input-group input:focus,
    .input-group select:focus {
      outline: none;
      border-color: #667eea;
    }

    .button-group {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    button {
      padding: 12px 24px;
      border: none;
      border-radius: 6px;
      font-size: 1em;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
    }

    .btn-primary {
      background: #667eea;
      color: white;
    }

    .btn-primary:hover {
      background: #5568d3;
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
    }

    .btn-secondary {
      background: #48bb78;
      color: white;
    }

    .btn-secondary:hover {
      background: #38a169;
      transform: translateY(-2px);
    }

    .btn-danger {
      background: #f56565;
      color: white;
    }

    .btn-danger:hover {
      background: #e53e3e;
      transform: translateY(-2px);
    }

    .btn-reset {
      background: #718096;
      color: white;
    }

    .btn-reset:hover {
      background: #4a5568;
    }

    .results {
      margin-top: 20px;
    }

    .book-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }

    .book-card {
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      border-radius: 8px;
      padding: 20px;
      transition: transform 0.3s;
    }

    .book-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
    }

    .book-title {
      font-size: 1.2em;
      font-weight: bold;
      color: #2d3748;
      margin-bottom: 8px;
    }

    .book-author {
      color: #667eea;
      margin-bottom: 12px;
      font-style: italic;
    }

    .book-details {
      font-size: 0.9em;
      color: #4a5568;
      line-height: 1.6;
    }

    .book-details div {
      margin: 4px 0;
    }

    .badge {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 0.8em;
      font-weight: 600;
      margin-top: 8px;
    }

    .badge-available {
      background: #c6f6d5;
      color: #22543d;
    }

    .badge-unavailable {
      background: #fed7d7;
      color: #742a2a;
    }

    .pagination {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 15px;
      margin-top: 20px;
      padding: 20px;
      background: #f7fafc;
      border-radius: 8px;
    }

    .pagination-info {
      color: #4a5568;
      font-weight: 600;
    }

    .code-block {
      background: #2d3748;
      color: #e2e8f0;
      padding: 15px;
      border-radius: 8px;
      overflow-x: auto;
      font-family: 'Courier New', monospace;
      font-size: 0.9em;
      margin: 15px 0;
    }

    .status-badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 4px;
      font-weight: 600;
      font-size: 0.85em;
    }

    .status-200 { background: #c6f6d5; color: #22543d; }
    .status-201 { background: #bee3f8; color: #2c5282; }
    .status-400 { background: #feebc8; color: #7c2d12; }
    .status-404 { background: #fed7d7; color: #742a2a; }

    .loading {
      text-align: center;
      padding: 40px;
      color: #667eea;
      font-size: 1.2em;
    }

    .spinner {
      border: 4px solid #f3f3f3;
      border-top: 4px solid #667eea;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 20px auto;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .create-form {
      display: grid;
      gap: 15px;
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üìö Library API Client</h1>
    <p class="subtitle">Interactive demonstration of API endpoints from the OpenAPI specification</p>

    <!-- SEARCH AND FILTER SECTION -->
    <div class="card">
      <h2>üîç Search & Filter Books (GET /books)</h2>
      
      <div class="filters">
        <div class="input-group">
          <label>Category</label>
          <select id="category">
            <option value="">All Categories</option>
            <option value="fiction">Fiction</option>
            <option value="technology">Technology</option>
          </select>
        </div>

        <div class="input-group">
          <label>Author</label>
          <input type="text" id="author" placeholder="e.g., Tolkien">
        </div>

        <div class="input-group">
          <label>Available Only</label>
          <select id="available">
            <option value="">Any</option>
            <option value="true">Available</option>
            <option value="false">Not Available</option>
          </select>
        </div>

        <div class="input-group">
          <label>Sort By</label>
          <select id="sort_by">
            <option value="title">Title</option>
            <option value="published_year">Year</option>
            <option value="author">Author</option>
          </select>
        </div>

        <div class="input-group">
          <label>Order</label>
          <select id="order">
            <option value="asc">Ascending</option>
            <option value="desc">Descending</option>
          </select>
        </div>

        <div class="input-group">
          <label>Items Per Page</label>
          <input type="number" id="limit" value="20" min="1" max="100">
        </div>
      </div>

      <div class="button-group">
        <button class="btn-primary" onclick="searchBooks()">üîç Search Books</button>
        <button class="btn-reset" onclick="resetFilters()">üîÑ Reset Filters</button>
      </div>

      <div id="requestUrl" class="code-block" style="margin-top: 15px;"></div>

      <div id="results"></div>
    </div>

    <!-- CREATE BOOK SECTION -->
    <div class="card">
      <h2>‚ûï Create New Book (POST /books)</h2>
      
      <div class="create-form">
        <div class="input-group">
          <label>Title *</label>
          <input type="text" id="newTitle" placeholder="e.g., Design Patterns">
        </div>

        <div class="input-group">
          <label>Author *</label>
          <input type="text" id="newAuthor" placeholder="e.g., Gang of Four">
        </div>

        <div class="input-group">
          <label>ISBN *</label>
          <input type="text" id="newIsbn" placeholder="e.g., 978-0201633610">
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px;">
          <div class="input-group">
            <label>Year</label>
            <input type="number" id="newYear" placeholder="2024">
          </div>

          <div class="input-group">
            <label>Category</label>
            <input type="text" id="newCategory" placeholder="fiction">
          </div>

          <div class="input-group">
            <label>Copies</label>
            <input type="number" id="newCopies" value="1" min="1">
          </div>
        </div>
      </div>

      <button class="btn-secondary" onclick="createBook()" style="margin-top: 15px;">
        ‚ûï Create Book
      </button>

      <div id="createResult"></div>
    </div>

    <!-- SINGLE BOOK OPERATIONS -->
    <div class="card">
      <h2>üéØ Single Book Operations</h2>
      
      <div style="display: flex; gap: 10px; align-items: end; flex-wrap: wrap;">
        <div class="input-group" style="flex: 1; min-width: 200px;">
          <label>Book ID</label>
          <input type="number" id="bookId" value="1" min="1">
        </div>
        <button class="btn-primary" onclick="getBook()">üìñ Get Book</button>
        <button class="btn-danger" onclick="deleteBook()">üóëÔ∏è Delete Book</button>
      </div>

      <div id="singleBookResult"></div>
    </div>
  </div>

  <script>
    const API_BASE_URL = 'http://localhost:3000';
    let currentPage = 1;

    // =============================================================================
    // SEARCH BOOKS - Demonstrates GET /books with query parameters
    // =============================================================================
    async function searchBooks(page = 1) {
      currentPage = page;

      // Build query parameters from form inputs
      const params = new URLSearchParams();
      
      const category = document.getElementById('category').value;
      const author = document.getElementById('author').value;
      const available = document.getElementById('available').value;
      const sort_by = document.getElementById('sort_by').value;
      const order = document.getElementById('order').value;
      const limit = document.getElementById('limit').value;

      if (category) params.append('category', category);
      if (author) params.append('author', author);
      if (available) params.append('available', available);
      if (sort_by) params.append('sort_by', sort_by);
      if (order) params.append('order', order);
      params.append('page', page);
      params.append('limit', limit);

      const url = `${API_BASE_URL}/books?${params.toString()}`;
      
      // Show the URL being called
      document.getElementById('requestUrl').innerHTML = `
        <div><strong>Request URL:</strong></div>
        <div style="color: #68d391; margin-top: 5px;">GET ${url}</div>
      `;

      // Show loading state
      document.getElementById('results').innerHTML = `
        <div class="loading">
          <div class="spinner"></div>
          Loading books...
        </div>
      `;

      try {
        // Make the API call
        const response = await fetch(url);
        const data = await response.json();

        if (response.ok) {
          displayBooks(data);
        } else {
          displayError(data, response.status);
        }
      } catch (error) {
        document.getElementById('results').innerHTML = `
          <div class="code-block" style="background: #742a2a; color: white;">
            <strong>‚ùå Network Error:</strong><br>
            ${error.message}<br><br>
            <em>Make sure the backend server is running on http://localhost:3000</em>
          </div>
        `;
      }
    }

    // =============================================================================
    // DISPLAY BOOKS - Shows the API response
    // =============================================================================
    function displayBooks(data) {
      const { data: books, pagination } = data;

      let html = `
        <div style="margin-top: 20px;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
            <h3 style="color: #48bb78;">‚úÖ ${pagination.total_items} Books Found</h3>
            <span class="status-badge status-200">200 OK</span>
          </div>
      `;

      if (books.length === 0) {
        html += '<p style="text-align: center; padding: 40px; color: #718096;">No books match your filters</p>';
      } else {
        html += '<div class="book-grid">';
        books.forEach(book => {
          const available = book.copies_available > 0;
          html += `
            <div class="book-card">
              <div class="book-title">${book.title}</div>
              <div class="book-author">by ${book.author}</div>
              <div class="book-details">
                <div>üìÖ Published: ${book.published_year || 'Unknown'}</div>
                <div>üìö Category: ${book.category || 'N/A'}</div>
                <div>üìñ ISBN: ${book.isbn}</div>
                <div>üìä Copies: ${book.copies_available}/${book.copies_total}</div>
              </div>
              <span class="badge ${available ? 'badge-available' : 'badge-unavailable'}">
                ${available ? '‚úì Available' : '‚úó Not Available'}
              </span>
            </div>
          `;
        });
        html += '</div>';
      }

      // Add pagination controls
      html += `
        <div class="pagination">
          <button class="btn-primary" onclick="searchBooks(${pagination.current_page - 1})" 
                  ${pagination.current_page === 1 ? 'disabled' : ''}>
            ‚Üê Previous
          </button>
          <span class="pagination-info">
            Page ${pagination.current_page} of ${pagination.total_pages}
            (${pagination.total_items} total books)
          </span>
          <button class="btn-primary" onclick="searchBooks(${pagination.current_page + 1})" 
                  ${pagination.current_page === pagination.total_pages ? 'disabled' : ''}>
            Next ‚Üí
          </button>
        </div>
      `;

      html += '</div>';
      document.getElementById('results').innerHTML = html;
    }

    // =============================================================================
    // CREATE BOOK - Demonstrates POST /books
    // =============================================================================
    async function createBook() {
      const title = document.getElementById('newTitle').value;
      const author = document.getElementById('newAuthor').value;
      const isbn = document.getElementById('newIsbn').value;
      const published_year = document.getElementById('newYear').value;
      const category = document.getElementById('newCategory').value;
      const copies_total = document.getElementById('newCopies').value;
      
      // backend must also include input validation - never trust fully on client-side software
      if (!title || !author || !isbn) {
        alert('Please fill in all required fields (Title, Author, ISBN)');
        return;
      }

      // Building a request body!
      const bookData = {
        title,
        author,
        isbn,
        // conditional spread
        // if published_year is not empty == true, else false
        // ...(true && {published_year: 1994}) == published_year: 1994
        // ...(false) == nothing in the body
        ...(published_year && { published_year: parseInt(published_year) }),
        ...(category && { category }),
        copies_total: parseInt(copies_total)
      };

      try {
        const response = await fetch(`${API_BASE_URL}/books`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(bookData)
        });

        const data = await response.json();

        let html = `
          <div class="code-block" style="margin-top: 15px; background: ${response.ok ? '#22543d' : '#742a2a'}">
            <div style="margin-bottom: 10px;">
              <span class="status-badge status-${response.status}">${response.status} ${response.statusText}</span>
            </div>
            <div><strong>Response:</strong></div>
            <pre style="margin-top: 10px;">${JSON.stringify(data, null, 2)}</pre>
          </div>
        `;
        // ${response.ok ? '#22543d' : '#742a2a'} - conditional styling of background color
        // kalo OK - background = green, else red. 

        // ${JSON.stringify(data, null, 2)}
        // provides indentation so that JSON looks like a JavaScript object, instead of a single line.

        // Response is going to have the status, header, and the json of the new book resource. 

        if (response.ok) {
          html += '<p style="color: #48bb78; margin-top: 10px;">‚úÖ Book created successfully! Try searching to see it.</p>';
          // Clear form
          document.getElementById('newTitle').value = '';
          document.getElementById('newAuthor').value = '';
          document.getElementById('newIsbn').value = '';
          document.getElementById('newYear').value = '';
          document.getElementById('newCategory').value = '';
          document.getElementById('newCopies').value = '1';
        }

        document.getElementById('createResult').innerHTML = html;
      } catch (error) {
        document.getElementById('createResult').innerHTML = `
          <div class="code-block" style="margin-top: 15px; background: #742a2a; color: white;">
            <strong>‚ùå Error:</strong> ${error.message}
          </div>
        `;
      }
    }

    // =============================================================================
    // GET SINGLE BOOK - Demonstrates GET /books/:id
    // =============================================================================
    async function getBook() {
      const id = document.getElementById('bookId').value;
      
      try {
        const response = await fetch(`${API_BASE_URL}/books/${id}`);
        const data = await response.json();

        let html = `
          <div class="code-block" style="margin-top: 15px; background: ${response.ok ? '#2c5282' : '#742a2a'}">
            <div style="margin-bottom: 10px;">
              <strong>GET /books/${id}</strong><br>
              <span class="status-badge status-${response.status}">${response.status} ${response.statusText}</span>
            </div>
            <pre>${JSON.stringify(data, null, 2)}</pre>
          </div>
        `;

        document.getElementById('singleBookResult').innerHTML = html;
      } catch (error) {
        document.getElementById('singleBookResult').innerHTML = `
          <div class="code-block" style="margin-top: 15px; background: #742a2a; color: white;">
            <strong>‚ùå Error:</strong> ${error.message}
          </div>
        `;
      }
    }

    // =============================================================================
    // DELETE BOOK - Demonstrates DELETE /books/:id
    // =============================================================================
    async function deleteBook() {
      const id = document.getElementById('bookId').value;
      
      if (!confirm(`Are you sure you want to delete book #${id}?`)) {
        return;
      }

      try {
        const response = await fetch(`${API_BASE_URL}/books/${id}`, {
          method: 'DELETE'
        });

        let html = `
          <div class="code-block" style="margin-top: 15px; background: ${response.ok ? '#22543d' : '#742a2a'}">
            <div style="margin-bottom: 10px;">
              <strong>DELETE /books/${id}</strong><br>
              <span class="status-badge status-${response.status}">${response.status} ${response.statusText}</span>
            </div>
        `;

        if (response.status === 204) {
          html += '<p style="color: #68d391;">‚úÖ Book deleted successfully!</p>';
        } else {
          const data = await response.json();
          html += `<pre>${JSON.stringify(data, null, 2)}</pre>`;
        }

        html += '</div>';
        document.getElementById('singleBookResult').innerHTML = html;
      } catch (error) {
        document.getElementById('singleBookResult').innerHTML = `
          <div class="code-block" style="margin-top: 15px; background: #742a2a; color: white;">
            <strong>‚ùå Error:</strong> ${error.message}
          </div>
        `;
      }
    }

    // =============================================================================
    // UTILITY FUNCTIONS
    // =============================================================================
    function displayError(data, status) {
      document.getElementById('results').innerHTML = `
        <div class="code-block" style="margin-top: 20px; background: #742a2a; color: white;">
          <div style="margin-bottom: 10px;">
            <span class="status-badge status-${status}">${status} Error</span>
          </div>
          <pre>${JSON.stringify(data, null, 2)}</pre>
        </div>
      `;
    }

    function resetFilters() {
      document.getElementById('category').value = '';
      document.getElementById('author').value = '';
      document.getElementById('available').value = '';
      document.getElementById('sort_by').value = 'title';
      document.getElementById('order').value = 'asc';
      document.getElementById('limit').value = '20';
      document.getElementById('results').innerHTML = '';
      document.getElementById('requestUrl').innerHTML = '';
    }

    // Load books on page load
    window.addEventListener('load', () => {
      searchBooks();
    });
  </script>
</body>
</html>
